# NxExample

This example workspace was forked from the [official Nrwl GitHub](https://github.com/nrwl/nx-examples).

The main app can be run like this:

```txt
ng serve products
```

Testing out the Storybook 6 Support in the latest [Nrwl newsletter for the release fo Nx 10.3](https://blog.nrwl.io/vs-code-jest-improved-eslint-support-typescript-4-storybook-6-and-more-with-nx-10-3-faf7c12fe556)
Nx now supports Storybook 6, which has the following notes:

* Nx generates stories with Component Story Format (CSF), the new standard way of writing component stories. 
* It's unable to automatically migrate users easily to Storybook 6 with the new component story format. 
* Nx still supports Storybook 5.x so users can upgrade as they are ready without waiting for other features in Nx 10.3. 
* New projects that are generated will be compatible with whichever version of Storybook is installed. 
* In Nx 10.3, we also added Storybook support for applications! So now, you can not only add Storybook configuration and generate stories for your libraries, but applications as well!

## Setting up Storybook

```txt
yarn add --dev @nrwl/storybook
npm add --dev @nrwl/storybook // Since I ran npm i, a package-lock file was generated, so switching to npm
nx g @nrwl/react:storybook-configuration project-name
? Configure a cypress e2e app to run against the storybook instance? Yes
? Automatically generate story files for components declared in this library? Yes
? Automatically generate *.spec.ts files in the cypress e2e app generated by the cypress-configure schematic? Yes
            There is already an e2e project setup
CREATE .storybook/main.js (84 bytes)
CREATE .storybook/tsconfig.json (180 bytes)
CREATE .storybook/webpack.config.js (472 bytes)
CREATE apps/products/.storybook/main.js (256 bytes)
CREATE apps/products/.storybook/preview.js (126 bytes)
CREATE apps/products/.storybook/tsconfig.json (222 bytes)
CREATE apps/products/.storybook/webpack.config.js (2181 bytes)
UPDATE package.json (3304 bytes)
UPDATE nx.json (2573 bytes)
UPDATE apps/products/tsconfig.app.json (434 bytes)
UPDATE apps/products/tsconfig.json (381 bytes)
UPDATE angular.json (19301 bytes)
- Installing packages...
... at least ten minutes later ...
nx run products:storybook
...
Version: webpack 4.44.2
Time: 42325ms
Built at: 11/03/2020 9:09:23 AM
                                          Asset      Size        Chunks                                Chunk Names
                                    iframe.html  2.92 KiB                [emitted]
            main.b4381b06eb31d7903e81.bundle.js  12.7 KiB          main  [emitted] [immutable]         main
        main.b4381b06eb31d7903e81.bundle.js.map   5.1 KiB          main  [emitted] [dev]               main
    runtime~main.b4381b06eb31d7903e81.bundle.js  33.5 KiB  runtime~main  [emitted] [immutable]         runtime~main
runtime~main.b4381b06eb31d7903e81.bundle.js.map  34.7 KiB  runtime~main  [emitted] [dev]               runtime~main
    vendors~main.b4381b06eb31d7903e81.bundle.js  3.05 MiB  vendors~main  [emitted] [immutable]  [big]  vendors~main
vendors~main.b4381b06eb31d7903e81.bundle.js.map  2.43 MiB  vendors~main  [emitted] [dev]               vendors~main
Entrypoint main [big] = runtime~main.b4381b06eb31d7903e81.bundle.js runtime~main.b4381b06eb31d7903e81.bundle.js.map vendors~main.b4381b06eb31d7903e81.bundle.js vendors~main.b4381b06eb31d7903e81.bundle.js.map main.b4381b06eb31d7903e81.bundle.js main.b4381b06eb31d7903e81.bundle.js.map
[0] multi ./node_modules/@storybook/core/dist/server/common/polyfills.js ./node_modules/@storybook/core/dist/server/preview/globals.js ./apps/products/.storybook/storybook-init-framework-entry.js ./apps/products/.storybook/preview.js-generated-config-entry.js ./apps/products/.storybook/generated-stories-entry.js ./node_modules/webpack-hot-middleware/client.js?reload=true&quiet=false&noInfo=true 88 bytes {main} [built]
[./apps/products/.storybook/generated-stories-entry.js] 442 bytes {main} [built]
[./apps/products/.storybook/preview.js] 125 bytes {main} [built]
[./apps/products/.storybook/preview.js-generated-config-entry.js] 2.87 KiB {main} [built]
[./apps/products/.storybook/storybook-init-framework-entry.js] 26 bytes {main} [built]
[./apps/products/src/app sync recursive ^\.(?:(?:^|[\\\/]|(?:(?:(?!(?:^|[\\\/])\.).)*?)[\\\/])(?!\.)(?=.)[^\\\/]*?\.stories\.(js|jsx|ts|tsx))$] ./apps/products/src/app sync ^\.(?:(?:^|[\\\/]|(?:(?:(?!(?:^|[\\\/])\.).)*?)[\\\/])(?!\.)(?=.)[^\\\/]*?\.stories\.(js|jsx|ts|tsx))$ 160 bytes {main} [built]
[./apps/products/src/app sync recursive ^\.(?:(?:^|[\\\/]|(?:(?:(?!(?:^|[\\\/])\.).)*?)[\\\/])(?!\.)(?=.)[^\\\/]*?\.stories\.mdx)$] ./apps/products/src/app sync ^\.(?:(?:^|[\\\/]|(?:(?:(?!(?:^|[\\\/])\.).)*?)[\\\/])(?!\.)(?=.)[^\\\/]*?\.stories\.mdx)$ 160 bytes {main} [built]
[./node_modules/@storybook/client-api/dist/index.js] 4.99 KiB {vendors~main} [built]
[./node_modules/@storybook/client-logger/dist/index.js] 3.66 KiB {vendors~main} [built]
[./node_modules/@storybook/core/dist/server/common/polyfills.js] 120 bytes {vendors~main} [built]
[./node_modules/@storybook/core/dist/server/preview/globals.js] 93 bytes {vendors~main} [built]
[./node_modules/@storybook/core/node_modules/core-js/features/symbol/index.js] 359 bytes {vendors~main} [built]
[./node_modules/@storybook/core/node_modules/webpack/buildin/module.js] (webpack)/buildin/module.js 497 bytes {vendors~main} [built]
[./node_modules/@storybook/react/dist/client/index.js] 1.88 KiB {vendors~main} [built]
[./node_modules/webpack-hot-middleware/client.js?reload=true&quiet=false&noInfo=true] 7.68 KiB {vendors~main} [built]
    + 1517 hidden modules
ERROR in ./apps/products/.storybook/preview.js-generated-config-entry.js
Module not found: Error: Can't resolve 'core-js/modules/es.array.filter' in 'C:\Users\timof\repos\timofeysie\nx\nx-examples\apps\products\.storybook'
 @ ./apps/products/.storybook/preview.js-generated-config-entry.js 5:0-42
 @ multi ./node_modules/@storybook/core/dist/server/common/polyfills.js ./node_modules/@storybook/core/dist/server/preview/globals.js ./apps/products/.storybook/storybook-init-framework-entry.js ./apps/products/.storybook/preview.js-generated-config-entry.js ./apps/products/.storybook/generated-stories-entry.js ./node_modules/webpack-hot-middleware/client.js?reload=true&quiet=false&noInfo=true
...
ERROR in ./apps/products/.storybook/preview.js-generated-config-entry.js
Module not found: Error: Can't resolve 'core-js/modules/es.symbol' in 'C:\Users\timof\repos\timofeysie\nx\nx-examples\apps\products\.storybook'
 @ ./apps/products/.storybook/preview.js-generated-config-entry.js 3:0-36
 @ multi ./node_modules/@storybook/core/dist/server/common/polyfills.js ./node_modules/@storybook/core/dist/server/preview/globals.js ./apps/products/.storybook/storybook-init-framework-entry.js ./apps/products/.storybook/preview.js-generated-config-entry.js ./apps/products/.storybook/generated-stories-entry.js ./node_modules/webpack-hot-middleware/client.js?reload=true&quiet=false&noInfo=true
ERROR in ./apps/products/.storybook/preview.js-generated-config-entry.js
Module not found: Error: Can't resolve 'core-js/modules/web.dom-collections.for-each' in 'C:\Users\timof\repos\timofeysie\nx\nx-examples\apps\products\.storybook'
 @ ./apps/products/.storybook/preview.js-generated-config-entry.js 19:0-55
 @ multi ./node_modules/@storybook/core/dist/server/common/polyfills.js ./node_modules/@storybook/core/dist/server/preview/globals.js ./apps/products/.storybook/storybook-init-framework-entry.js ./apps/products/.storybook/preview.js-generated-config-entry.js ./apps/products/.storybook/generated-stories-entry.js ./node_modules/webpack-hot-middleware/client.js?reload=true&quiet=false&noInfo=true
```

The docs say: *The @nrwl/angular:storybook-configuration schematic has the option to automatically generate *.stories.ts files for each component declared in the library.*

```txt
<some-folder>
â”œâ”€â”€ my.component.ts
â””â”€â”€ my.component.stories.ts
```

But there are none of these generated in the project.

We are using nx --version 10.3.1-beta.1

Looking at [this issue], tried adding this:

*just add NODE_PATH=src before start-storybook, at least it works for me:*

```js
"scripts": {
  "storybook": "NODE_PATH=src start-storybook -p 3001 -c .storybook -s ./public"
}
```

Assuming that is the package.json file of course.  But it didn't help.  The output was the same.  At the end however were errors like this:

```txt
Error from chokidar (C:\): Error: EBUSY: resource busy or locked, lstat 'C:\hiberfil.sys'
```

Actually, scrolling up those errors were there the first time also.

## Original Readme

This project was generated using [Nx](https://nx.dev).

<p align="center"><img src="https://raw.githubusercontent.com/nrwl/nx/master/nx-logo.png" width="450"></p>

ðŸ”Ž **Nx is a set of Angular CLI power-ups for modern development.**

## Nx 5 Example

If you are looking for the Nx 5 Example, it is available on the [`nx-v5-example` branch](https://github.com/nrwl/nx-examples/commits/nx-v5-example).

## Quick Start & Documentation

[Nx Documentation](https://nx.dev)

[30-minute video showing all Nx features](https://nx.dev/getting-started/what-is-nx)

[Interactive Tutorial](https://nx.dev/tutorial/01-create-application)

## Adding capabilities to your workspace

Nx supports many plugins which add capabilities for developing different types of applications and different tools.

These capabilities include generating applications, libraries, .etc as well as the devtools to test, and build projects as well.

Below are some plugins which you can add to your workspace:

- [Angular](https://angular.io)
  - `ng add @nrwl/angular`
- [React](https://reactjs.org)
  - `ng add @nrwl/react`
- Web (no framework frontends)
  - `ng add @nrwl/web`
- [Nest](https://nestjs.com)
  - `ng add @nrwl/nest`
- [Express](https://expressjs.com)
  - `ng add @nrwl/express`
- [Node](https://nodejs.org)
  - `ng add @nrwl/node`

## Generate an application

Run `ng g @nrwl/angular:app my-app` to generate an application.

> You can use any of the plugins above to generate applications as well.

When using Nx, you can create multiple applications and libraries in the same workspace.

## Generate a library

Run `ng g @nrwl/angular:lib my-lib` to generate a library.

> You can also use any of the plugins above to generate libraries as well.

Libraries are sharable across libraries and applications. They can be imported from `@nx-example/mylib`.

## Development server

Run `ng serve my-app` for a dev server. Navigate to http://localhost:4200/. The app will automatically reload if you change any of the source files.

## Code scaffolding

Run `ng g component my-component --project=my-app` to generate a new component.

## Build

Run `ng build my-app` to build the project. The build artifacts will be stored in the `dist/` directory. Use the `--prod` flag for a production build.

## Running unit tests

Run `ng test my-app` to execute the unit tests via [Jest](https://jestjs.io).

Run `npm run affected:test` to execute the unit tests affected by a change.

## Running end-to-end tests

Run `ng e2e my-app` to execute the end-to-end tests via [Cypress](https://www.cypress.io).

Run `npm run affected:e2e` to execute the end-to-end tests affected by a change.

## Understand your workspace

Run `npm run dep-graph` to see a diagram of the dependencies of your projects.

## Further help

Visit the [Nx Documentation](https://nx.dev) to learn more.
