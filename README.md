# NxExample

This example workspace was forked from the [official Nrwl GitHub](https://github.com/nrwl/nx-examples).

The main app can be run like this:

```txt
ng serve products
```

Testing out the Storybook 6 Support in the latest [Nrwl newsletter for the release fo Nx 10.3](https://blog.nrwl.io/vs-code-jest-improved-eslint-support-typescript-4-storybook-6-and-more-with-nx-10-3-faf7c12fe556)
Nx now supports Storybook 6, which has the following notes:

* Nx generates stories with Component Story Format (CSF), the new standard way of writing component stories. 
* It's unable to automatically migrate users easily to Storybook 6 with the new component story format. 
* Nx still supports Storybook 5.x so users can upgrade as they are ready without waiting for other features in Nx 10.3. 
* New projects that are generated will be compatible with whichever version of Storybook is installed. 
* In Nx 10.3, we also added Storybook support for applications! So now, you can not only add Storybook configuration and generate stories for your libraries, but applications as well!

## Setting up Storybook

```txt
yarn add --dev @nrwl/storybook
npm add --dev @nrwl/storybook // Since I ran npm i, a package-lock file was generated, so switching to npm
>nx g @nrwl/angular:storybook-configuration products
? Configure a cypress e2e app to run against the storybook instance? Yes
? Automatically generate *.stories.ts files for components declared in this library? Yes
? Automatically generate *.spec.ts files in the cypress e2e app generated by the cypress-configure schematic? Yes
            There is already an e2e project setup
CREATE .storybook/main.js (84 bytes)
CREATE .storybook/tsconfig.json (180 bytes)
CREATE .storybook/webpack.config.js (472 bytes)
CREATE apps/products/.storybook/main.js (256 bytes)
CREATE apps/products/.storybook/preview.js (128 bytes)
CREATE apps/products/.storybook/tsconfig.json (163 bytes)
CREATE apps/products/.storybook/webpack.config.js (606 bytes)
CREATE apps/products/src/app/app.component.stories.ts (211 bytes)
CREATE apps/products-e2e/src/integration/app.component.spec.ts (202 bytes)
UPDATE package.json (3149 bytes)
UPDATE nx.json (2573 bytes)
UPDATE apps/products/tsconfig.app.json (386 bytes)
UPDATE apps/products/tsconfig.json (381 bytes)
UPDATE angular.json (19305 bytes)
√ Packages installed successfully.

C:\Users\timof\repos\timofeysie\nx\nx-examples>nx run products:storybook

> ng run products:storybook
An unhandled exception occurred: Cannot find module '@storybook/core/dist/server/build-dev'
Require stack:
- C:\Users\timof\repos\timofeysie\nx\nx-examples\node_modules\@nrwl\storybook\src\builders\storybook\storybook.impl.js
- C:\Users\timof\repos\timofeysie\nx\nx-examples\node_modules\@angular-devkit\architect\node\node-modules-architect-host.js
- C:\Users\timof\repos\timofeysie\nx\nx-examples\node_modules\@angular-devkit\architect\node\index.js
- C:\Users\timof\repos\timofeysie\nx\nx-examples\node_modules\@angular\cli\models\architect-command.js
- C:\Users\timof\repos\timofeysie\nx\nx-examples\node_modules\@angular\cli\commands\run-impl.js
- C:\Users\timof\repos\timofeysie\nx\nx-examples\node_modules\@angular-devkit\schematics\tools\export-ref.js
- C:\Users\timof\repos\timofeysie\nx\nx-examples\node_modules\@angular-devkit\schematics\tools\index.js
- C:\Users\timof\repos\timofeysie\nx\nx-examples\node_modules\@angular\cli\utilities\json-schema.js
- C:\Users\timof\repos\timofeysie\nx\nx-examples\node_modules\@angular\cli\models\command-runner.js
- C:\Users\timof\repos\timofeysie\nx\nx-examples\node_modules\@angular\cli\lib\cli\index.js
- C:\Users\timof\repos\timofeysie\nx\nx-examples\node_modules\@angular\cli\lib\init.js
- C:\Users\timof\repos\timofeysie\nx\nx-examples\node_modules\@nrwl\cli\lib\run-cli.js
See "C:\Users\timof\AppData\Local\Temp\ng-SM3SSc\angular-errors.log" for further details.
>  NX   CLOUD  See run details at https://nx.app/runs/XQhH3VwmNwH
```

Looking at th[this issue](https://github.com/nrwl/nx/issues/2665) for a solution.  The problem is described there as *Nx added a devDependency for @babel/core targetting version 8.0.6, which doesn't exist (latest version is 7.8.7). This makes the npm install fail silently and thus the storybook files aren't being installed inside node_modules.*

But it doesn't work:

```txt
npm install --save-dev @babel/core@latest
>nx run products:storybook

> ng run products:storybook
info => Loading presets
info => Loading presets
info => Loading config/preview file in "apps/products/.storybook".
info => Adding stories defined in "apps\products\.storybook\main.js".
info => Found custom tsconfig.json
info => Using angular project 'products' for configuring Storybook.
info => Loading angular-cli config.
info => Get angular-cli webpack config.
info => Loading custom Webpack config (full-control mode).
Starting type checking service...
webpack built 04e8ccb487e60fa13aa0 in 41636ms
× ｢wdm｣: Hash: 04e8ccb487e60fa13aa0
Version: webpack 4.44.1
Time: 41636ms
Built at: 11/03/2020 11:39:20 PM
                                          Asset      Size        Chunks                                Chunk Names
                                     _redirects  81 bytes                [emitted]
                        assets/icons/github.png  2.28 KiB                [emitted]
             assets/images/a-clash-of-kings.jpg   521 KiB                [emitted]              [big]
         assets/images/a-dance-with-dragons.jpg   479 KiB                [emitted]              [big]
            assets/images/a-feast-for-crows.jpg  49.4 KiB                [emitted]
            assets/images/a-game-of-thrones.jpg   848 KiB                [emitted]              [big]
            assets/images/a-storm-of-swords.jpg   696 KiB                [emitted]              [big]
                                    favicon.ico  14.7 KiB                [emitted]
                                    iframe.html  2.92 KiB                [emitted]
            main.04e8ccb487e60fa13aa0.bundle.js[22m  35.1 KiB          main  [emitted] [immutable]         main
        main.04e8ccb487e60fa13aa0.bundle.js.map  19.5 KiB          main  [emitted] [dev]               main
    runtime~main.04e8ccb487e60fa13aa0.bundle.js  33.5 KiB  runtime~main  [emitted] [immutable]         runtime~main
runtime~main.04e8ccb487e60fa13aa0.bundle.js.map  34.7 KiB  runtime~main  [emitted] [dev]               runtime~main
    vendors~main.04e8ccb487e60fa13aa0.bundle.js  5.67 MiB  vendors~main  [emitted] [immutable]  [big]  vendors~main
vendors~main.04e8ccb487e60fa13aa0.bundle.js.map  5.57 MiB  vendors~main  [emitted] [dev]               vendors~main
Entrypoint main [big] = runtime~main.04e8ccb487e60fa13aa0.bundle.js runtime~main.04e8ccb487e60fa13aa0.bundle.js.map vendors~main.04e8ccb487e60fa13aa0.bundle.js vendors~main.04e8ccb487e60fa13aa0.bundle.js.map main.04e8ccb487e60fa13aa0.bundle.js main.04e8ccb487e60fa13aa0.bundle.js.map
[0] multi ./node_modules/@storybook/core/dist/server/common/polyfills.js ./node_modules/@storybook/core/dist/server/preview/globals.js ./apps/products/.storybook/storybook-init-framework-entry.js ./apps/products/.storybook/preview.js-generated-config-entry.js ./apps/products/.storybook/generated-stories-entry.js (webpack)-hot-middleware/client.js?reload=true&quiet=false&noInfo=true ./libs/shared/styles/src/index.scss ./libs/shared/header/index.scss ./node_modules/normalize.css/normalize.css 124 bytes {main} [built]
[./apps/products/.storybook/generated-stories-entry.js] 444 bytes {main} [built]
[./apps/products/.storybook/preview.js] 127 bytes {main} [built]
[./apps/products/.storybook/preview.js-generated-config-entry.js] 2.87 KiB {main} [built]
[./apps/products/.storybook/storybook-init-framework-entry.js] 28 bytes {main} [built]
[./apps/products/src/app sync recursive ^\.(?:(?:^|[\\\/]|(?:(?:(?!(?:^|[\\\/])\.).)*?)[\\\/])(?!\.)(?=.)[^\\\/]*?\.stories\.(js|jsx|ts|tsx))$] ./apps/products/src/app sync ^\.(?:(?:^|[\\\/]|(?:(?:(?!(?:^|[\\\/])\.).)*?)[\\\/])(?!\.)(?=.)[^\\\/]*?\.stories\.(js|jsx|ts|tsx))$ 191 bytes {main} [built]
[./apps/products/src/app sync recursive ^\.(?:(?:^|[\\\/]|(?:(?:(?!(?:^|[\\\/])\.).)*?)[\\\/])(?!\.)(?=.)[^\\\/]*?\.stories\.mdx)$] ./apps/products/src/app sync ^\.(?:(?:^|[\\\/]|(?:(?:(?!(?:^|[\\\/])\.).)*?)[\\\/])(?!\.)(?=.)[^\\\/]*?\.stories\.mdx)$ 160 bytes {main} [built]
[./libs/shared/header/index.scss] 2.11 KiB {main} [built]
[./libs/shared/styles/src/index.scss] 2.15 KiB {main} [built]
[./node_modules/@storybook/angular/dist/client/index.js] 1.83 KiB {vendors~main} [built]
[./node_modules/@storybook/client-api/dist/index.js] 4.99 KiB {vendors~main} [built]
[./node_modules/@storybook/core/dist/server/common/polyfills.js] 120 bytes {vendors~main} [built]
[./node_modules/@storybook/core/dist/server/preview/globals.js] 93 bytes {vendors~main} [built]
[./node_modules/normalize.css/normalize.css] 1.65 KiB {vendors~main} [built]
[./node_modules/webpack-hot-middleware/client.js?reload=true&quiet=false&noInfo=true] (webpack)-hot-middleware/client.js?reload=true&quiet=false&noInfo=true 7.68 KiB {vendors~main} [built]
    + 977 hidden modules
ERROR in ./apps/products/.storybook/preview.js-generated-config-entry.js
Module not found: Error: Can't resolve 'core-js/modules/es.array.filter' in 'C:\Users\timof\repos\timofeysie\nx\nx-examples\apps\products\.storybook'
 @ ./apps/products/.storybook/preview.js-generated-config-entry.js 5:0-42
 @ multi ./node_modules/@storybook/core/dist/server/common/polyfills.js ./node_modules/@storybook/core/dist/server/preview/globals.js ./apps/products/.storybook/storybook-init-framework-entry.js ./apps/products/.storybook/preview.js-generated-config-entry.js ./apps/products/.storybook/generated-stories-entry.js (webpack)-hot-middleware/client.js?reload=true&quiet=false&noInfo=true ./libs/shared/styles/src/index.scss ./libs/shared/header/index.scss ./node_modules/normalize.css/normalize.css
 ... more of these ...
ERROR in ./apps/products/.storybook/preview.js-generated-config-entry.js
Module not found: Error: Can't resolve 'core-js/modules/web.dom-collections.for-each' in 'C:\Users\timof\repos\timofeysie\nx\nx-examples\apps\products\.storybook'
 @ ./apps/products/.storybook/preview.js-generated-config-entry.js 19:0-55
 @ multi ./node_modules/@storybook/core/dist/server/common/polyfills.js ./node_modules/@storybook/core/dist/server/preview/globals.js ./apps/products/.storybook/storybook-init-framework-entry.js ./apps/products/.storybook/preview.js-generated-config-entry.js ./apps/products/.storybook/generated-stories-entry.js (webpack)-hot-middleware/client.js?reload=true&quiet=false&noInfo=true ./libs/shared/styles/src/index.scss ./libs/shared/header/index.scss ./node_modules/normalize.css/normalize.css
Child HtmlWebpackCompiler:
                          Asset      Size               Chunks  Chunk Names
    __child-HtmlWebpackPlugin_0  6.35 KiB  HtmlWebpackPlugin_0  HtmlWebpackPlugin_0
    Entrypoint HtmlWebpackPlugin_0 = __child-HtmlWebpackPlugin_0
    [./node_modules/html-webpack-plugin/lib/loader.js!./node_modules/@storybook/core/dist/server/templates/index.ejs] 2.14 KiB {HtmlWebpackPlugin_0} [built]
WARN Broken build, fix the error above.
WARN You may need to refresh the browser.
Error from chokidar (C:\): Error: EBUSY: resource busy or locked, lstat 'C:\hiberfil.sys'
Error from chokidar (C:\): Error: EBUSY: resource busy or locked, lstat 'C:\pagefile.sys'
Error from chokidar (C:\): Error: EBUSY: resource busy or locked, lstat 'C:\swapfile.sys'
```

## Original Readme

This project was generated using [Nx](https://nx.dev).

<p align="center"><img src="https://raw.githubusercontent.com/nrwl/nx/master/nx-logo.png" width="450"></p>

🔎 **Nx is a set of Angular CLI power-ups for modern development.**

## Nx 5 Example

If you are looking for the Nx 5 Example, it is available on the [`nx-v5-example` branch](https://github.com/nrwl/nx-examples/commits/nx-v5-example).

## Quick Start & Documentation

[Nx Documentation](https://nx.dev)

[30-minute video showing all Nx features](https://nx.dev/getting-started/what-is-nx)

[Interactive Tutorial](https://nx.dev/tutorial/01-create-application)

## Adding capabilities to your workspace

Nx supports many plugins which add capabilities for developing different types of applications and different tools.

These capabilities include generating applications, libraries, .etc as well as the devtools to test, and build projects as well.

Below are some plugins which you can add to your workspace:

- [Angular](https://angular.io)
  - `ng add @nrwl/angular`
- [React](https://reactjs.org)
  - `ng add @nrwl/react`
- Web (no framework frontends)
  - `ng add @nrwl/web`
- [Nest](https://nestjs.com)
  - `ng add @nrwl/nest`
- [Express](https://expressjs.com)
  - `ng add @nrwl/express`
- [Node](https://nodejs.org)
  - `ng add @nrwl/node`

## Generate an application

Run `ng g @nrwl/angular:app my-app` to generate an application.

> You can use any of the plugins above to generate applications as well.

When using Nx, you can create multiple applications and libraries in the same workspace.

## Generate a library

Run `ng g @nrwl/angular:lib my-lib` to generate a library.

> You can also use any of the plugins above to generate libraries as well.

Libraries are sharable across libraries and applications. They can be imported from `@nx-example/mylib`.

## Development server

Run `ng serve my-app` for a dev server. Navigate to http://localhost:4200/. The app will automatically reload if you change any of the source files.

## Code scaffolding

Run `ng g component my-component --project=my-app` to generate a new component.

## Build

Run `ng build my-app` to build the project. The build artifacts will be stored in the `dist/` directory. Use the `--prod` flag for a production build.

## Running unit tests

Run `ng test my-app` to execute the unit tests via [Jest](https://jestjs.io).

Run `npm run affected:test` to execute the unit tests affected by a change.

## Running end-to-end tests

Run `ng e2e my-app` to execute the end-to-end tests via [Cypress](https://www.cypress.io).

Run `npm run affected:e2e` to execute the end-to-end tests affected by a change.

## Understand your workspace

Run `npm run dep-graph` to see a diagram of the dependencies of your projects.

## Further help

Visit the [Nx Documentation](https://nx.dev) to learn more.
